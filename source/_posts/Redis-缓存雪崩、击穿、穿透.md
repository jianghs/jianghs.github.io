---
title: Redis 缓存雪崩、击穿、穿透
date: 2020-03-18 16:08:39
tags: Redis
categories: Coding
---

## 缓存雪崩

### 雪崩描述

热点数据进行缓存，一般缓存是定时任务刷新或者查询不到之后去更新。

定时任务刷新会有这种情况，当 Redis Key 全部失效时，正好有大流量，此时全部直接查询数据库，导致数据库无法抗住流量。而且重启数据库后又会被新的流量打死。

同一时间大面积失效，那一瞬间Redis跟没有一样，那这个数量级别的请求直接打到数据库几乎是灾难性的。

### 雪崩解决方案

1. 在批量往Redis存数据的时候，把每个Key的失效时间都加个随机值就好了，这样可以保证数据不会在同一时间大面积失效。
2. 如果Redis是集群部署，将热点数据均匀分布在不同的Redis库中也能避免全部失效的问题。
3. 设置热点数据永远不过期，有更新操作就更新缓存。

## 缓存穿透

### 穿透描述

缓存穿透是指缓存和数据库中都没有的数据，而用户不断发起请求，我们数据库的 id 都是1开始自增上去的，如发起为id值为 -1 的数据或 id 为特别大不存在的数据。这时的用户很可能是攻击者，攻击会导致数据库压力过大，严重会击垮数据库。

### 穿透解决方案

接口层增加校验，比如用户鉴权校验，参数做校验，不合法的参数直接代码Return。

从缓存取不到的数据，在数据库中也没有取到，这时也可以将对应Key的Value对写为null、位置错误、稍后重试这样的值。

布隆过滤器（Bloom Filter）这个也能很好的防止缓存穿透的发生，他的原理也很简单就是利用高效的数据结构和算法快速判断出你这个Key是否在数据库中存在，不存在你return就好了，存在你就去查了DB刷新KV再return。

## 缓存击穿

### 击穿描述

缓存击穿是指一个Key非常热点，在不停的扛着大并发，大并发集中对这一个点进行访问，当这个Key在失效的瞬间，持续的大并发就穿破缓存，直接请求数据库，就像在一个完好无损的桶上凿开了一个洞。

### 击穿解决方案

设置热点数据永远不过期

加上互斥锁
